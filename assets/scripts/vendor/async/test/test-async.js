function eachIterator(e,n,t){setTimeout(function(){e.push(n),t()},25*n)}function mapIterator(e,n,t){setTimeout(function(){e.push(n),t(null,2*n)},25*n)}function filterIterator(e,n){setTimeout(function(){n(e%2)},25*e)}function detectIterator(e,n,t){setTimeout(function(){e.push(n),t(2==n)},25*n)}function eachNoCallbackIterator(e,n,t){e.equal(n,1),t(),e.done()}function getFunctionsObject(e){return{one:function(n){setTimeout(function(){e.push(1),n(null,1)},125)},two:function(n){setTimeout(function(){e.push(2),n(null,2)},200)},three:function(n){setTimeout(function(){e.push(3),n(null,3,3)},50)}}}var async=require("../lib/async");Function.prototype.bind||(Function.prototype.bind=function(e){var n=Array.prototype.slice.call(arguments,1),t=this;return function(){t.apply(e,n.concat(Array.prototype.slice.call(arguments)))}}),exports.forever=function(e){function n(e){return t++,50===t?e("too big!"):void async.setImmediate(function(){e()})}e.expect(1);var t=0;async.forever(n,function(n){e.equal(n,"too big!"),e.done()})},exports.applyEach=function(e){e.expect(4);var n=[],t=function(t,o){e.equal(t,5),setTimeout(function(){n.push("one"),o(null,1)},100)},o=function(t,o){e.equal(t,5),setTimeout(function(){n.push("two"),o(null,2)},50)},u=function(t,o){e.equal(t,5),setTimeout(function(){n.push("three"),o(null,3)},150)};async.applyEach([t,o,u],5,function(){e.same(n,["two","one","three"]),e.done()})},exports.applyEachSeries=function(e){e.expect(4);var n=[],t=function(t,o){e.equal(t,5),setTimeout(function(){n.push("one"),o(null,1)},100)},o=function(t,o){e.equal(t,5),setTimeout(function(){n.push("two"),o(null,2)},50)},u=function(t,o){e.equal(t,5),setTimeout(function(){n.push("three"),o(null,3)},150)};async.applyEachSeries([t,o,u],5,function(){e.same(n,["one","two","three"]),e.done()})},exports["applyEach partial application"]=function(e){e.expect(4);var n=[],t=function(t,o){e.equal(t,5),setTimeout(function(){n.push("one"),o(null,1)},100)},o=function(t,o){e.equal(t,5),setTimeout(function(){n.push("two"),o(null,2)},50)},u=function(t,o){e.equal(t,5),setTimeout(function(){n.push("three"),o(null,3)},150)};async.applyEach([t,o,u])(5,function(){e.same(n,["two","one","three"]),e.done()})},exports.compose=function(e){e.expect(4);var n=function(n,t){e.equal(n,3),setTimeout(function(){t(null,n+2)},50)},t=function(n,t){e.equal(n,5),setTimeout(function(){t(null,3*n)},15)},o=function(n,t){e.equal(n,15),setTimeout(function(){t(null,n+1)},100)},u=async.compose(o,t,n);u(3,function(n,t){return n?e.done(n):(e.equal(t,16),void e.done())})},exports["compose error"]=function(e){e.expect(3);var n=new Error("test"),t=function(n,t){e.equal(n,3),setTimeout(function(){t(null,n+2)},50)},o=function(t,o){e.equal(t,5),setTimeout(function(){o(n)},15)},u=function(n,t){e.ok(!1,"add1 should not get called"),setTimeout(function(){t(null,n+1)},100)},a=async.compose(u,o,t);a(3,function(t){e.equal(t,n),e.done()})},exports["compose binding"]=function(e){e.expect(4);var n=(new Error("test"),{name:"foo"}),t=function(t,o){e.equal(this,n),setTimeout(function(){o(null,t+2)},50)},o=function(t,o){e.equal(this,n),setTimeout(function(){o(null,3*t)},15)},u=async.compose(o,t);u.call(n,3,function(t,o){return t?e.done(t):(e.equal(this,n),e.equal(o,15),void e.done())})},exports.seq=function(e){e.expect(4);var n=function(n,t){e.equal(n,3),setTimeout(function(){t(null,n+2)},50)},t=function(n,t){e.equal(n,5),setTimeout(function(){t(null,3*n)},15)},o=function(n,t){e.equal(n,15),setTimeout(function(){t(null,n+1)},100)},u=async.seq(n,t,o);u(3,function(n,t){return n?e.done(n):(e.equal(t,16),void e.done())})},exports["seq error"]=function(e){e.expect(3);var n=new Error("test"),t=function(n,t){e.equal(n,3),setTimeout(function(){t(null,n+2)},50)},o=function(t,o){e.equal(t,5),setTimeout(function(){o(n)},15)},u=function(n,t){e.ok(!1,"add1 should not get called"),setTimeout(function(){t(null,n+1)},100)},a=async.seq(t,o,u);a(3,function(t){e.equal(t,n),e.done()})},exports["seq binding"]=function(e){e.expect(4);var n=(new Error("test"),{name:"foo"}),t=function(t,o){e.equal(this,n),setTimeout(function(){o(null,t+2)},50)},o=function(t,o){e.equal(this,n),setTimeout(function(){o(null,3*t)},15)},u=async.seq(t,o);u.call(n,3,function(t,o){return t?e.done(t):(e.equal(this,n),e.equal(o,15),void e.done())})},exports.auto=function(e){var n=[];async.auto({task1:["task2",function(e){setTimeout(function(){n.push("task1"),e()},25)}],task2:function(e){setTimeout(function(){n.push("task2"),e()},50)},task3:["task2",function(e){n.push("task3"),e()}],task4:["task1","task2",function(e){n.push("task4"),e()}],task5:["task2",function(e){setTimeout(function(){n.push("task5"),e()},0)}],task6:["task2",function(e){n.push("task6"),e()}]},function(){e.same(n,["task2","task6","task3","task5","task1","task4"]),e.done()})},exports["auto petrify"]=function(e){var n=[];async.auto({task1:["task2",function(e){setTimeout(function(){n.push("task1"),e()},100)}],task2:function(e){setTimeout(function(){n.push("task2"),e()},200)},task3:["task2",function(e){n.push("task3"),e()}],task4:["task1","task2",function(e){n.push("task4"),e()}]},function(){e.same(n,["task2","task3","task1","task4"]),e.done()})},exports["auto results"]=function(e){var n=[];async.auto({task1:["task2",function(t,o){e.same(o.task2,"task2"),setTimeout(function(){n.push("task1"),t(null,"task1a","task1b")},25)}],task2:function(e){setTimeout(function(){n.push("task2"),e(null,"task2")},50)},task3:["task2",function(t,o){e.same(o.task2,"task2"),n.push("task3"),t(null)}],task4:["task1","task2",function(t,o){e.same(o.task1,["task1a","task1b"]),e.same(o.task2,"task2"),n.push("task4"),t(null,"task4")}]},function(t,o){e.same(n,["task2","task3","task1","task4"]),e.same(o,{task1:["task1a","task1b"],task2:"task2",task3:void 0,task4:"task4"}),e.done()})},exports["auto empty object"]=function(e){async.auto({},function(){e.done()})},exports["auto error"]=function(e){e.expect(1),async.auto({task1:function(e){e("testerror")},task2:["task1",function(n){e.ok(!1,"task2 should not be called"),n()}],task3:function(e){e("testerror2")}},function(n){e.equals(n,"testerror")}),setTimeout(e.done,100)},exports["auto no callback"]=function(e){async.auto({task1:function(e){e()},task2:["task1",function(n){n(),e.done()}]})},exports["auto error should pass partial results"]=function(e){async.auto({task1:function(e){e(!1,"result1")},task2:["task1",function(e){e("testerror","result2")}],task3:["task2",function(){e.ok(!1,"task3 should not be called")}]},function(n,t){e.equals(n,"testerror"),e.equals(t.task1,"result1"),e.equals(t.task2,"result2"),e.done()})},exports["auto removeListener has side effect on loop iterator"]=function(e){async.auto({task1:["task3",function(){e.done()}],task2:["task3",function(){}],task3:function(e){e()}})},exports["auto calls callback multiple times"]=function(e){if("undefined"==typeof process)return void e.done();var n=0,t=require("domain").create();t.on("error",function(n){return n._test_error?void 0:e.done(n)}),t.run(function(){async.auto({task1:function(e){e(null)},task2:["task1",function(e){e(null)}]},function(){n++;var e=new Error("An error");throw e._test_error=!0,e})}),setTimeout(function(){e.equal(n,1,"Final auto callback should only be called once"),e.done()},10)},exports["auto modifying results causes final callback to run early"]=function(e){async.auto({task1:function(e,n){n.inserted=!0,e(null,"task1")},task2:function(e){setTimeout(function(){e(null,"task2")},50)},task3:function(e){setTimeout(function(){e(null,"task3")},100)}},function(n,t){e.equal(t.inserted,!0),e.ok(t.task3,"task3"),e.done()})},exports["retry when attempt succeeds"]=function(e){function n(e){o++,t--,t?e(!0):e(null,u)}var t=3,o=0,u="success";async.retry(n,function(n,t){e.equal(o,3,"did not retry the correct number of times"),e.equal(t,u,"did not return the expected result"),e.done()})},exports["retry when all attempts succeeds"]=function(e){function n(e){o++,e(u+o,a+o)}var t=3,o=0,u="ERROR",a="RESULT";async.retry(t,n,function(n,s){e.equal(o,3,"did not retry the correct number of times"),e.equal(n,u+t,"Incorrect error was returned"),e.equal(s,a+t,"Incorrect result was returned"),e.done()})},exports["retry as an embedded task"]=function(e){var n,t,o="RETRY";async.auto({foo:function(e,t){n=t,e(null,"FOO")},retry:async.retry(function(e,n){t=n,e(null,o)})},function(u,a){e.equal(a.retry,o,"Incorrect result was returned from retry function"),e.equal(n,t,"Incorrect results were passed to retry function"),e.done()})},exports.waterfall=function(e){e.expect(6);var n=[];async.waterfall([function(e){n.push("fn1"),setTimeout(function(){e(null,"one","two")},0)},function(t,o,u){n.push("fn2"),e.equals(t,"one"),e.equals(o,"two"),setTimeout(function(){u(null,t,o,"three")},25)},function(t,o,u,a){n.push("fn3"),e.equals(t,"one"),e.equals(o,"two"),e.equals(u,"three"),a(null,"four")},function(t,o){n.push("fn4"),e.same(n,["fn1","fn2","fn3","fn4"]),o(null,"test")}],function(){e.done()})},exports["waterfall empty array"]=function(e){async.waterfall([],function(){e.done()})},exports["waterfall non-array"]=function(e){async.waterfall({},function(n){e.equals(n.message,"First argument to waterfall must be an array of functions"),e.done()})},exports["waterfall no callback"]=function(e){async.waterfall([function(e){e()},function(n){n(),e.done()}])},exports["waterfall async"]=function(e){var n=[];async.waterfall([function(e){n.push(1),e(),n.push(2)},function(e){n.push(3),e()},function(){e.same(n,[1,2,3]),e.done()}])},exports["waterfall error"]=function(e){e.expect(1),async.waterfall([function(e){e("error")},function(n){e.ok(!1,"next function should not be called"),n()}],function(n){e.equals(n,"error")}),setTimeout(e.done,50)},exports["waterfall multiple callback calls"]=function(e){var n=[],t=[function(e){n.push(1),e(null,"one","two"),e(null,"one","two")},function(e,t,o){n.push(2),o(null,e,t,"three")},function(e,t,o,u){n.push(3),u(null,"four")},function(){n.push(4),t[3]=function(){n.push(4),e.same(n,[1,2,2,3,3,4,4]),e.done()}}];async.waterfall(t)},exports.parallel=function(e){var n=[];async.parallel([function(e){setTimeout(function(){n.push(1),e(null,1)},50)},function(e){setTimeout(function(){n.push(2),e(null,2)},100)},function(e){setTimeout(function(){n.push(3),e(null,3,3)},25)}],function(t,o){e.equals(t,null),e.same(n,[3,1,2]),e.same(o,[1,2,[3,3]]),e.done()})},exports["parallel empty array"]=function(e){async.parallel([],function(n,t){e.equals(n,null),e.same(t,[]),e.done()})},exports["parallel error"]=function(e){async.parallel([function(e){e("error",1)},function(e){e("error2",2)}],function(n){e.equals(n,"error")}),setTimeout(e.done,100)},exports["parallel no callback"]=function(e){async.parallel([function(e){e()},function(n){n(),e.done()}])},exports["parallel object"]=function(e){var n=[];async.parallel(getFunctionsObject(n),function(t,o){e.equals(t,null),e.same(n,[3,1,2]),e.same(o,{one:1,two:2,three:[3,3]}),e.done()})},exports["parallel limit"]=function(e){var n=[];async.parallelLimit([function(e){setTimeout(function(){n.push(1),e(null,1)},50)},function(e){setTimeout(function(){n.push(2),e(null,2)},100)},function(e){setTimeout(function(){n.push(3),e(null,3,3)},25)}],2,function(t,o){e.equals(t,null),e.same(n,[1,3,2]),e.same(o,[1,2,[3,3]]),e.done()})},exports["parallel limit empty array"]=function(e){async.parallelLimit([],2,function(n,t){e.equals(n,null),e.same(t,[]),e.done()})},exports["parallel limit error"]=function(e){async.parallelLimit([function(e){e("error",1)},function(e){e("error2",2)}],1,function(n){e.equals(n,"error")}),setTimeout(e.done,100)},exports["parallel limit no callback"]=function(e){async.parallelLimit([function(e){e()},function(n){n(),e.done()}],1)},exports["parallel limit object"]=function(e){var n=[];async.parallelLimit(getFunctionsObject(n),2,function(t,o){e.equals(t,null),e.same(n,[1,3,2]),e.same(o,{one:1,two:2,three:[3,3]}),e.done()})},exports.series=function(e){var n=[];async.series([function(e){setTimeout(function(){n.push(1),e(null,1)},25)},function(e){setTimeout(function(){n.push(2),e(null,2)},50)},function(e){setTimeout(function(){n.push(3),e(null,3,3)},15)}],function(t,o){e.equals(t,null),e.same(o,[1,2,[3,3]]),e.same(n,[1,2,3]),e.done()})},exports["series empty array"]=function(e){async.series([],function(n,t){e.equals(n,null),e.same(t,[]),e.done()})},exports["series error"]=function(e){e.expect(1),async.series([function(e){e("error",1)},function(n){e.ok(!1,"should not be called"),n("error2",2)}],function(n){e.equals(n,"error")}),setTimeout(e.done,100)},exports["series no callback"]=function(e){async.series([function(e){e()},function(n){n(),e.done()}])},exports["series object"]=function(e){var n=[];async.series(getFunctionsObject(n),function(t,o){e.equals(t,null),e.same(o,{one:1,two:2,three:[3,3]}),e.same(n,[1,2,3]),e.done()})},exports.iterator=function(e){var n=[],t=async.iterator([function(){n.push(1)},function(t){e.equals(t,"arg1"),n.push(2)},function(t,o){e.equals(t,"arg1"),e.equals(o,"arg2"),n.push(3)}]);t(),e.same(n,[1]);var o=t();e.same(n,[1,1]);var u=o("arg1");e.same(n,[1,1,2]);var a=u("arg1","arg2");e.same(n,[1,1,2,3]),e.equals(a,void 0),e.done()},exports["iterator empty array"]=function(e){var n=async.iterator([]);e.equals(n(),void 0),e.equals(n.next(),void 0),e.done()},exports["iterator.next"]=function(e){var n=[],t=async.iterator([function(){n.push(1)},function(t){e.equals(t,"arg1"),n.push(2)},function(t,o){e.equals(t,"arg1"),e.equals(o,"arg2"),n.push(3)}]),o=t.next(),u=o("arg1");e.same(n,[2]),u("arg1","arg2"),e.same(n,[2,3]),e.equals(u.next(),void 0),e.done()},exports.each=function(e){var n=[];async.each([1,3,2],eachIterator.bind(this,n),function(){e.same(n,[1,2,3]),e.done()})},exports["each extra callback"]=function(e){var n=0;async.each([1,3,2],function(t,o){n++,o(),e.throws(o),3==n&&e.done()})},exports["each empty array"]=function(e){e.expect(1),async.each([],function(n,t){e.ok(!1,"iterator should not be called"),t()},function(){e.ok(!0,"should call callback")}),setTimeout(e.done,25)},exports["each error"]=function(e){e.expect(1),async.each([1,2,3],function(e,n){n("error")},function(n){e.equals(n,"error")}),setTimeout(e.done,50)},exports["each no callback"]=function(e){async.each([1],eachNoCallbackIterator.bind(this,e))},exports["forEach alias"]=function(e){e.strictEqual(async.each,async.forEach),e.done()},exports.eachSeries=function(e){var n=[];async.eachSeries([1,3,2],eachIterator.bind(this,n),function(){e.same(n,[1,3,2]),e.done()})},exports["eachSeries empty array"]=function(e){e.expect(1),async.eachSeries([],function(n,t){e.ok(!1,"iterator should not be called"),t()},function(){e.ok(!0,"should call callback")}),setTimeout(e.done,25)},exports["eachSeries error"]=function(e){e.expect(2);var n=[];async.eachSeries([1,2,3],function(e,t){n.push(e),t("error")},function(t){e.same(n,[1]),e.equals(t,"error")}),setTimeout(e.done,50)},exports["eachSeries no callback"]=function(e){async.eachSeries([1],eachNoCallbackIterator.bind(this,e))},exports["forEachSeries alias"]=function(e){e.strictEqual(async.eachSeries,async.forEachSeries),e.done()},exports.eachLimit=function(e){var n=[],t=[0,1,2,3,4,5,6,7,8,9];async.eachLimit(t,2,function(e,t){setTimeout(function(){n.push(e),t()},5*e)},function(){e.same(n,t),e.done()})},exports["eachLimit empty array"]=function(e){e.expect(1),async.eachLimit([],2,function(n,t){e.ok(!1,"iterator should not be called"),t()},function(){e.ok(!0,"should call callback")}),setTimeout(e.done,25)},exports["eachLimit limit exceeds size"]=function(e){var n=[],t=[0,1,2,3,4,5,6,7,8,9];async.eachLimit(t,20,eachIterator.bind(this,n),function(){e.same(n,t),e.done()})},exports["eachLimit limit equal size"]=function(e){var n=[],t=[0,1,2,3,4,5,6,7,8,9];async.eachLimit(t,10,eachIterator.bind(this,n),function(){e.same(n,t),e.done()})},exports["eachLimit zero limit"]=function(e){e.expect(1),async.eachLimit([0,1,2,3,4,5],0,function(n,t){e.ok(!1,"iterator should not be called"),t()},function(){e.ok(!0,"should call callback")}),setTimeout(e.done,25)},exports["eachLimit error"]=function(e){e.expect(2);var n=[0,1,2,3,4,5,6,7,8,9],t=[];async.eachLimit(n,3,function(e,n){t.push(e),2===e&&n("error")},function(n){e.same(t,[0,1,2]),e.equals(n,"error")}),setTimeout(e.done,25)},exports["eachLimit no callback"]=function(e){async.eachLimit([1],1,eachNoCallbackIterator.bind(this,e))},exports["eachLimit synchronous"]=function(e){var n=[],t=[0,1,2];async.eachLimit(t,5,function(e,t){n.push(e),t()},function(){e.same(n,t),e.done()})},exports["forEachLimit alias"]=function(e){e.strictEqual(async.eachLimit,async.forEachLimit),e.done()},exports.map=function(e){var n=[];async.map([1,3,2],mapIterator.bind(this,n),function(t,o){e.same(n,[1,2,3]),e.same(o,[2,6,4]),e.done()})},exports["map original untouched"]=function(e){var n=[1,2,3];async.map(n,function(e,n){n(null,2*e)},function(t,o){e.same(o,[2,4,6]),e.same(n,[1,2,3]),e.done()})},exports["map without main callback"]=function(e){var n=[1,2,3],t=[];async.map(n,function(o,u){t.push(o),u(null),t.length>=n.length&&(e.same(t,n),e.done())})},exports["map error"]=function(e){e.expect(1),async.map([1,2,3],function(e,n){n("error")},function(n){e.equals(n,"error")}),setTimeout(e.done,50)},exports.mapSeries=function(e){var n=[];async.mapSeries([1,3,2],mapIterator.bind(this,n),function(t,o){e.same(n,[1,3,2]),e.same(o,[2,6,4]),e.done()})},exports["mapSeries error"]=function(e){e.expect(1),async.mapSeries([1,2,3],function(e,n){n("error")},function(n){e.equals(n,"error")}),setTimeout(e.done,50)},exports.mapLimit=function(e){var n=[];async.mapLimit([2,4,3],2,mapIterator.bind(this,n),function(t,o){e.same(n,[2,4,3]),e.same(o,[4,8,6]),e.done()})},exports["mapLimit empty array"]=function(e){e.expect(1),async.mapLimit([],2,function(n,t){e.ok(!1,"iterator should not be called"),t()},function(){e.ok(!0,"should call callback")}),setTimeout(e.done,25)},exports["mapLimit limit exceeds size"]=function(e){var n=[];async.mapLimit([0,1,2,3,4,5,6,7,8,9],20,mapIterator.bind(this,n),function(t,o){e.same(n,[0,1,2,3,4,5,6,7,8,9]),e.same(o,[0,2,4,6,8,10,12,14,16,18]),e.done()})},exports["mapLimit limit equal size"]=function(e){var n=[];async.mapLimit([0,1,2,3,4,5,6,7,8,9],10,mapIterator.bind(this,n),function(t,o){e.same(n,[0,1,2,3,4,5,6,7,8,9]),e.same(o,[0,2,4,6,8,10,12,14,16,18]),e.done()})},exports["mapLimit zero limit"]=function(e){e.expect(2),async.mapLimit([0,1,2,3,4,5],0,function(n,t){e.ok(!1,"iterator should not be called"),t()},function(n,t){e.same(t,[]),e.ok(!0,"should call callback")}),setTimeout(e.done,25)},exports["mapLimit error"]=function(e){e.expect(2);var n=[0,1,2,3,4,5,6,7,8,9],t=[];async.mapLimit(n,3,function(e,n){t.push(e),2===e&&n("error")},function(n){e.same(t,[0,1,2]),e.equals(n,"error")}),setTimeout(e.done,25)},exports.reduce=function(e){var n=[];async.reduce([1,2,3],0,function(e,t,o){n.push(t),o(null,e+t)},function(t,o){e.equals(o,6),e.same(n,[1,2,3]),e.done()})},exports["reduce async with non-reference memo"]=function(e){async.reduce([1,3,2],0,function(e,n,t){setTimeout(function(){t(null,e+n)},100*Math.random())},function(n,t){e.equals(t,6),e.done()})},exports["reduce error"]=function(e){e.expect(1),async.reduce([1,2,3],0,function(e,n,t){t("error")},function(n){e.equals(n,"error")}),setTimeout(e.done,50)},exports["inject alias"]=function(e){e.equals(async.inject,async.reduce),e.done()},exports["foldl alias"]=function(e){e.equals(async.foldl,async.reduce),e.done()},exports.reduceRight=function(e){var n=[],t=[1,2,3];async.reduceRight(t,0,function(e,t,o){n.push(t),o(null,e+t)},function(o,u){e.equals(u,6),e.same(n,[3,2,1]),e.same(t,[1,2,3]),e.done()})},exports["foldr alias"]=function(e){e.equals(async.foldr,async.reduceRight),e.done()},exports.filter=function(e){async.filter([3,1,2],filterIterator,function(n){e.same(n,[3,1]),e.done()})},exports["filter original untouched"]=function(e){var n=[3,1,2];async.filter(n,function(e,n){n(e%2)},function(t){e.same(t,[3,1]),e.same(n,[3,1,2]),e.done()})},exports.filterSeries=function(e){async.filterSeries([3,1,2],filterIterator,function(n){e.same(n,[3,1]),e.done()})},exports["select alias"]=function(e){e.equals(async.select,async.filter),e.done()},exports["selectSeries alias"]=function(e){e.equals(async.selectSeries,async.filterSeries),e.done()},exports.reject=function(e){async.reject([3,1,2],filterIterator,function(n){e.same(n,[2]),e.done()})},exports["reject original untouched"]=function(e){var n=[3,1,2];async.reject(n,function(e,n){n(e%2)},function(t){e.same(t,[2]),e.same(n,[3,1,2]),e.done()})},exports.rejectSeries=function(e){async.rejectSeries([3,1,2],filterIterator,function(n){e.same(n,[2]),e.done()})},exports["some true"]=function(e){async.some([3,1,2],function(e,n){setTimeout(function(){n(1===e)},0)},function(n){e.equals(n,!0),e.done()})},exports["some false"]=function(e){async.some([3,1,2],function(e,n){setTimeout(function(){n(10===e)},0)},function(n){e.equals(n,!1),e.done()})},exports["some early return"]=function(e){var n=[];async.some([1,2,3],function(e,t){setTimeout(function(){n.push(e),t(1===e)},25*e)},function(){n.push("callback")}),setTimeout(function(){e.same(n,[1,"callback",2,3]),e.done()},100)},exports["any alias"]=function(e){e.equals(async.any,async.some),e.done()},exports["every true"]=function(e){async.every([1,2,3],function(e,n){setTimeout(function(){n(!0)},0)},function(n){e.equals(n,!0),e.done()})},exports["every false"]=function(e){async.every([1,2,3],function(e,n){setTimeout(function(){n(e%2)},0)},function(n){e.equals(n,!1),e.done()})},exports["every early return"]=function(e){var n=[];async.every([1,2,3],function(e,t){setTimeout(function(){n.push(e),t(1===e)},25*e)},function(){n.push("callback")}),setTimeout(function(){e.same(n,[1,2,"callback",3]),e.done()},100)},exports["all alias"]=function(e){e.equals(async.all,async.every),e.done()},exports.detect=function(e){var n=[];async.detect([3,2,1],detectIterator.bind(this,n),function(t){n.push("callback"),e.equals(t,2)}),setTimeout(function(){e.same(n,[1,2,"callback",3]),e.done()},100)},exports["detect - mulitple matches"]=function(e){var n=[];async.detect([3,2,2,1,2],detectIterator.bind(this,n),function(t){n.push("callback"),e.equals(t,2)}),setTimeout(function(){e.same(n,[1,2,"callback",2,2,3]),e.done()},100)},exports.detectSeries=function(e){var n=[];async.detectSeries([3,2,1],detectIterator.bind(this,n),function(t){n.push("callback"),e.equals(t,2)}),setTimeout(function(){e.same(n,[3,2,"callback"]),e.done()},200)},exports["detectSeries - multiple matches"]=function(e){var n=[];async.detectSeries([3,2,2,1,2],detectIterator.bind(this,n),function(t){n.push("callback"),e.equals(t,2)}),setTimeout(function(){e.same(n,[3,2,"callback"]),e.done()},200)},exports.sortBy=function(e){async.sortBy([{a:1},{a:15},{a:6}],function(e,n){setTimeout(function(){n(null,e.a)},0)},function(n,t){e.same(t,[{a:1},{a:6},{a:15}]),e.done()})},exports["sortBy inverted"]=function(e){async.sortBy([{a:1},{a:15},{a:6}],function(e,n){setTimeout(function(){n(null,-1*e.a)},0)},function(n,t){e.same(t,[{a:15},{a:6},{a:1}]),e.done()})},exports.apply=function(e){e.expect(6);var n=function(){e.same(Array.prototype.slice.call(arguments),[1,2,3,4])};async.apply(n,1,2,3,4)(),async.apply(n,1,2,3)(4),async.apply(n,1,2)(3,4),async.apply(n,1)(2,3,4),async.apply(n)(1,2,3,4),e.equals(async.apply(function(e){return"hello "+e},"world")(),"hello world"),e.done()};var console_fn_tests=function(e){"undefined"!=typeof console&&(exports[e]=function(n){n.expect(5);var t=function(e,t){n.equals(e,"one"),setTimeout(function(){t(null,"test")},0)},o=function(e,t){n.equals(e,"one"),setTimeout(function(){t("error")},0)},u=console[e],a=console.error;console[e]=function(t){n.equals(t,"test"),n.equals(arguments.length,1),console.error=function(t){n.equals(t,"error"),console[e]=u,console.error=a,n.done()},async[e](o,"one")},async[e](t,"one")},exports[e+" with multiple result params"]=function(n){var t=function(e){e(null,"one","two","three")},o=console[e],u=[];console[e]=function(e){u.push(e)},async[e](t),n.same(u,["one","two","three"]),console[e]=o,n.done()}),exports[e+" without console."+e]=function(n){if("undefined"!=typeof window){var t=window.console;window.console=void 0;var o=function(e){e(null,"val")},u=function(e){e("error")};async[e](o),async[e](u),window.console=t}n.done()}};exports.times=function(e){async.times(5,function(e,n){n(null,e)},function(n,t){e.same(t,[0,1,2,3,4]),e.done()})},exports.times=function(e){var n=[];async.times(3,function(e,t){setTimeout(function(){n.push(e),t()},25*e)},function(){e.same(n,[0,1,2]),e.done()})},exports["times 0"]=function(e){e.expect(1),async.times(0,function(n,t){e.ok(!1,"iterator should not be called"),t()},function(){e.ok(!0,"should call callback")}),setTimeout(e.done,25)},exports["times error"]=function(e){e.expect(1),async.times(3,function(e,n){n("error")},function(n){e.equals(n,"error")}),setTimeout(e.done,50)},exports.timesSeries=function(e){var n=[];async.timesSeries(5,function(e,t){setTimeout(function(){n.push(e),t(null,e)},100-10*e)},function(t,o){e.same(n,[0,1,2,3,4]),e.same(o,[0,1,2,3,4]),e.done()})},exports["timesSeries error"]=function(e){e.expect(1),async.timesSeries(5,function(e,n){n("error")},function(n){e.equals(n,"error")}),setTimeout(e.done,50)},console_fn_tests("log"),console_fn_tests("dir"),exports.nextTick=function(e){var n=[];async.nextTick(function(){n.push("two")}),n.push("one"),setTimeout(function(){e.same(n,["one","two"]),e.done()},50)},exports["nextTick in the browser"]=function(e){if("undefined"!=typeof process)return e.done();e.expect(1);var n=[];async.nextTick(function(){n.push("two")}),n.push("one"),setTimeout(function(){"undefined"!=typeof process&&(process.nextTick=_nextTick),e.same(n,["one","two"])},50),setTimeout(e.done,100)},exports["noConflict - node only"]=function(e){if("undefined"!=typeof process){e.expect(3);var n=require("fs"),t=__dirname+"/../lib/async.js";n.readFile(t,function(n,o){if(n)return e.done();var u=process.binding("evals").Script||process.binding("evals").NodeScript,a=new u(o,t),s=new u(o+"this.async2 = this.async.noConflict();",t),c={async:"oldvalue"};a.runInNewContext(c),e.ok(c.async);var r={async:"oldvalue"};s.runInNewContext(r),e.equals(r.async,"oldvalue"),e.ok(r.async2),e.done()})}else e.done()},exports.concat=function(e){var n=[],t=function(e,t){setTimeout(function(){n.push(e);for(var o=[];e>0;)o.push(e),e--;t(null,o)},25*e)};async.concat([1,3,2],t,function(t,o){e.same(o,[1,2,1,3,2,1]),e.same(n,[1,2,3]),e.ok(!t),e.done()})},exports["concat error"]=function(e){var n=function(e,n){n(new Error("test error"))};async.concat([1,2,3],n,function(n){e.ok(n),e.done()})},exports.concatSeries=function(e){var n=[],t=function(e,t){setTimeout(function(){n.push(e);for(var o=[];e>0;)o.push(e),e--;t(null,o)},25*e)};async.concatSeries([1,3,2],t,function(t,o){e.same(o,[1,3,2,1,2,1]),e.same(n,[1,3,2]),e.ok(!t),e.done()})},exports.until=function(e){var n=[],t=0;async.until(function(){return n.push(["test",t]),5==t},function(e){n.push(["iterator",t]),t++,e()},function(){e.same(n,[["test",0],["iterator",0],["test",1],["iterator",1],["test",2],["iterator",2],["test",3],["iterator",3],["test",4],["iterator",4],["test",5]]),e.equals(t,5),e.done()})},exports.doUntil=function(e){var n=[],t=0;async.doUntil(function(e){n.push(["iterator",t]),t++,e()},function(){return n.push(["test",t]),5==t},function(){e.same(n,[["iterator",0],["test",1],["iterator",1],["test",2],["iterator",2],["test",3],["iterator",3],["test",4],["iterator",4],["test",5]]),e.equals(t,5),e.done()})},exports["doUntil callback params"]=function(e){var n=[],t=0;async.doUntil(function(e){n.push(["iterator",t]),t++,e(null,t)},function(e){return n.push(["test",e]),5==e},function(){e.same(n,[["iterator",0],["test",1],["iterator",1],["test",2],["iterator",2],["test",3],["iterator",3],["test",4],["iterator",4],["test",5]]),e.equals(t,5),e.done()})},exports.whilst=function(e){var n=[],t=0;async.whilst(function(){return n.push(["test",t]),5>t},function(e){n.push(["iterator",t]),t++,e()},function(){e.same(n,[["test",0],["iterator",0],["test",1],["iterator",1],["test",2],["iterator",2],["test",3],["iterator",3],["test",4],["iterator",4],["test",5]]),e.equals(t,5),e.done()})},exports.doWhilst=function(e){var n=[],t=0;async.doWhilst(function(e){n.push(["iterator",t]),t++,e()},function(){return n.push(["test",t]),5>t},function(){e.same(n,[["iterator",0],["test",1],["iterator",1],["test",2],["iterator",2],["test",3],["iterator",3],["test",4],["iterator",4],["test",5]]),e.equals(t,5),e.done()})},exports["doWhilst callback params"]=function(e){var n=[],t=0;async.doWhilst(function(e){n.push(["iterator",t]),t++,e(null,t)},function(e){return n.push(["test",e]),5>e},function(){e.same(n,[["iterator",0],["test",1],["iterator",1],["test",2],["iterator",2],["test",3],["iterator",3],["test",4],["iterator",4],["test",5]]),e.equals(t,5),e.done()})},exports.queue=function(e){var n=[],t=[160,80,240,80],o=async.queue(function(e,o){setTimeout(function(){n.push("process "+e),o("error","arg")},t.splice(0,1)[0])},2);o.push(1,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),1),n.push("callback 1")}),o.push(2,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),2),n.push("callback 2")}),o.push(3,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),0),n.push("callback 3")}),o.push(4,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),0),n.push("callback 4")}),e.equal(o.length(),4),e.equal(o.concurrency,2),o.drain=function(){e.same(n,["process 2","callback 2","process 1","callback 1","process 4","callback 4","process 3","callback 3"]),e.equal(o.concurrency,2),e.equal(o.length(),0),e.done()}},exports["queue default concurrency"]=function(e){var n=[],t=[160,80,240,80],o=async.queue(function(e,o){setTimeout(function(){n.push("process "+e),o("error","arg")},t.splice(0,1)[0])});o.push(1,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),3),n.push("callback 1")}),o.push(2,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),2),n.push("callback 2")}),o.push(3,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),1),n.push("callback 3")}),o.push(4,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),0),n.push("callback 4")}),e.equal(o.length(),4),e.equal(o.concurrency,1),o.drain=function(){e.same(n,["process 1","callback 1","process 2","callback 2","process 3","callback 3","process 4","callback 4"]),e.equal(o.concurrency,1),e.equal(o.length(),0),e.done()}},exports["queue error propagation"]=function(e){var n=[],t=async.queue(function(e,n){n("foo"===e.name?new Error("fooError"):null)},2);t.drain=function(){e.deepEqual(n,["bar","fooError"]),e.done()},t.push({name:"bar"},function(e){return e?void n.push("barError"):void n.push("bar")}),t.push({name:"foo"},function(e){return e?void n.push("fooError"):void n.push("foo")})},exports["queue changing concurrency"]=function(e){var n=[],t=[40,20,60,20],o=async.queue(function(e,o){setTimeout(function(){n.push("process "+e),o("error","arg")},t.splice(0,1)[0])},2);o.push(1,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),3),n.push("callback 1")}),o.push(2,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),2),n.push("callback 2")}),o.push(3,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),1),n.push("callback 3")}),o.push(4,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),0),n.push("callback 4")}),e.equal(o.length(),4),e.equal(o.concurrency,2),o.concurrency=1,setTimeout(function(){e.same(n,["process 1","callback 1","process 2","callback 2","process 3","callback 3","process 4","callback 4"]),e.equal(o.concurrency,1),e.equal(o.length(),0),e.done()},250)},exports["queue push without callback"]=function(e){var n=[],t=[160,80,240,80],o=async.queue(function(e,o){setTimeout(function(){n.push("process "+e),o("error","arg")},t.splice(0,1)[0])},2);o.push(1),o.push(2),o.push(3),o.push(4),setTimeout(function(){e.same(n,["process 2","process 1","process 4","process 3"]),e.done()},800)},exports["queue unshift"]=function(e){var n=[],t=async.queue(function(e,t){n.push(e),t()
},1);t.unshift(4),t.unshift(3),t.unshift(2),t.unshift(1),setTimeout(function(){e.same(n,[1,2,3,4]),e.done()},100)},exports["queue too many callbacks"]=function(e){var n=async.queue(function(n,t){t(),e.throws(function(){t()}),e.done()},2);n.push(1)},exports["queue bulk task"]=function(e){var n=[],t=[160,80,240,80],o=async.queue(function(e,o){setTimeout(function(){n.push("process "+e),o("error",e)},t.splice(0,1)[0])},2);o.push([1,2,3,4],function(t,o){e.equal(t,"error"),n.push("callback "+o)}),e.equal(o.length(),4),e.equal(o.concurrency,2),setTimeout(function(){e.same(n,["process 2","callback 2","process 1","callback 1","process 4","callback 4","process 3","callback 3"]),e.equal(o.concurrency,2),e.equal(o.length(),0),e.done()},800)},exports["queue idle"]=function(e){var n=async.queue(function(t,o){e.equal(n.idle(),!1),o()},1);e.equal(n.idle(),!0),n.unshift(4),n.unshift(3),n.unshift(2),n.unshift(1),e.equal(n.idle(),!1),n.drain=function(){e.equal(n.idle(),!0),e.done()}},exports["queue pause"]=function(e){function n(){var e=s.shift();e&&setTimeout(function(){r.push(e),n()},o)}var t=[],o=100,u=300,a=500,s=[1,2,3,4,5,6],c=function(){var e=+Date.now();return function(){return 100*Math.floor((+Date.now()-e)/100)}}(),r=async.queue(function(e,n){t.push("process "+e),t.push("timeout "+c()),n()});n(),setTimeout(function(){r.pause(),e.equal(r.paused,!0)},u),setTimeout(function(){r.resume(),e.equal(r.paused,!1)},a),setTimeout(function(){e.same(t,["process 1","timeout 100","process 2","timeout 200","process 3","timeout 500","process 4","timeout 500","process 5","timeout 500","process 6","timeout 600"]),e.done()},800)},exports["queue kill"]=function(e){var n=async.queue(function(n,t){setTimeout(function(){e.ok(!1,"Function should never be called"),t()},300)},1);n.drain=function(){e.ok(!1,"Function should never be called")},n.push(0),n.kill(),setTimeout(function(){e.equal(n.length(),0),e.done()},600)},exports.priorityQueue=function(e){var n=[],t=async.priorityQueue(function(e,t){n.push("process "+e),t("error","arg")},1);t.push(1,1.4,function(o,u){e.equal(o,"error"),e.equal(u,"arg"),e.equal(t.length(),2),n.push("callback 1")}),t.push(2,.2,function(o,u){e.equal(o,"error"),e.equal(u,"arg"),e.equal(t.length(),3),n.push("callback 2")}),t.push(3,3.8,function(o,u){e.equal(o,"error"),e.equal(u,"arg"),e.equal(t.length(),0),n.push("callback 3")}),t.push(4,2.9,function(o,u){e.equal(o,"error"),e.equal(u,"arg"),e.equal(t.length(),1),n.push("callback 4")}),e.equal(t.length(),4),e.equal(t.concurrency,1),t.drain=function(){e.same(n,["process 2","callback 2","process 1","callback 1","process 4","callback 4","process 3","callback 3"]),e.equal(t.concurrency,1),e.equal(t.length(),0),e.done()}},exports["priorityQueue concurrency"]=function(e){var n=[],t=[160,80,240,80],o=async.priorityQueue(function(e,o){setTimeout(function(){n.push("process "+e),o("error","arg")},t.splice(0,1)[0])},2);o.push(1,1.4,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),2),n.push("callback 1")}),o.push(2,.2,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),1),n.push("callback 2")}),o.push(3,3.8,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),0),n.push("callback 3")}),o.push(4,2.9,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),0),n.push("callback 4")}),e.equal(o.length(),4),e.equal(o.concurrency,2),o.drain=function(){e.same(n,["process 1","callback 1","process 2","callback 2","process 3","callback 3","process 4","callback 4"]),e.equal(o.concurrency,2),e.equal(o.length(),0),e.done()}},exports.cargo=function(e){var n=[],t=[160,160,80],o=async.cargo(function(e,o){setTimeout(function(){n.push("process "+e.join(" ")),o("error","arg")},t.shift())},2);o.push(1,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),3),n.push("callback 1")}),o.push(2,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),3),n.push("callback 2")}),e.equal(o.length(),2),setTimeout(function(){o.push(3,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),1),n.push("callback 3")})},60),setTimeout(function(){o.push(4,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),1),n.push("callback 4")}),e.equal(o.length(),2),o.push(5,function(t,u){e.equal(t,"error"),e.equal(u,"arg"),e.equal(o.length(),0),n.push("callback 5")})},120),setTimeout(function(){e.same(n,["process 1 2","callback 1","callback 2","process 3 4","callback 3","callback 4","process 5","callback 5"]),e.equal(o.length(),0),e.done()},800)},exports["cargo without callback"]=function(e){var n=[],t=[160,80,240,80],o=async.cargo(function(e,o){setTimeout(function(){n.push("process "+e.join(" ")),o("error","arg")},t.shift())},2);o.push(1),setTimeout(function(){o.push(2)},120),setTimeout(function(){o.push(3),o.push(4),o.push(5)},180),setTimeout(function(){e.same(n,["process 1","process 2","process 3 4","process 5"]),e.done()},800)},exports["cargo bulk task"]=function(e){var n=[],t=[120,40],o=async.cargo(function(e,o){setTimeout(function(){n.push("process "+e.join(" ")),o("error",e.join(" "))},t.shift())},3);o.push([1,2,3,4],function(t,o){e.equal(t,"error"),n.push("callback "+o)}),e.equal(o.length(),4),setTimeout(function(){e.same(n,["process 1 2 3","callback 1 2 3","callback 1 2 3","callback 1 2 3","process 4","callback 4"]),e.equal(o.length(),0),e.done()},800)},exports["cargo drain once"]=function(e){var n=async.cargo(function(e,n){n()},3),t=0;n.drain=function(){t++};for(var o=0;10>o;o++)n.push(o);setTimeout(function(){e.equal(t,1),e.done()},500)},exports["cargo drain twice"]=function(e){var n=async.cargo(function(e,n){n()},3),t=function(){for(var e=0;10>e;e++)n.push(e)},o=0;n.drain=function(){o++},t(),setTimeout(t,500),setTimeout(function(){e.equal(o,2),e.done()},1e3)},exports.memoize=function(e){e.expect(4);var n=[],t=function(e,t,o){async.setImmediate(function(){n.push(["fn",e,t]),o(null,e+t)})},o=async.memoize(t);o(1,2,function(t,u){e.equal(u,3),o(1,2,function(t,u){e.equal(u,3),o(2,2,function(t,o){e.equal(o,4),e.same(n,[["fn",1,2],["fn",2,2]]),e.done()})})})},exports["memoize maintains asynchrony"]=function(e){function n(){var n=[["fn",1,2],"tick1",["cb",1,2],"tick2","tick3"];e.same(t,n),e.done()}e.expect(3);var t=[],o=function(e,n,o){t.push(["fn",e,n]),async.setImmediate(function(){t.push(["cb",e,n]),o(null,e+n)})},u=async.memoize(o);u(1,2,function(o,a){e.equal(a,3),u(1,2,function(o,u){e.equal(u,3),async.nextTick(n),t.push("tick3")}),t.push("tick2")}),t.push("tick1")},exports.unmemoize=function(e){e.expect(4);var n=[],t=function(e,t,o){n.push(["fn",e,t]),async.setImmediate(function(){o(null,e+t)})},o=async.memoize(t),u=async.unmemoize(o);u(1,2,function(t,o){e.equal(o,3),u(1,2,function(t,o){e.equal(o,3),u(2,2,function(t,o){e.equal(o,4),e.same(n,[["fn",1,2],["fn",1,2],["fn",2,2]]),e.done()})})})},exports["unmemoize a not memoized function"]=function(e){e.expect(1);var n=function(e,n,t){t(null,e+n)},t=async.unmemoize(n);t(1,2,function(n,t){e.equal(t,3)}),e.done()},exports["memoize error"]=function(e){e.expect(1);var n=new Error("test"),t=function(e,t,o){o(n,e+t)};async.memoize(t)(1,2,function(t){e.equal(t,n)}),e.done()},exports["memoize multiple calls"]=function(e){e.expect(3);var n=function(n,t,o){e.ok(!0),setTimeout(function(){o(null,n,t)},10)},t=async.memoize(n);t(1,2,function(n,t){e.equal(t,1,2)}),t(1,2,function(n,t){e.equal(t,1,2),e.done()})},exports["memoize custom hash function"]=function(e){e.expect(2);var n=new Error("test"),t=function(e,t,o){o(n,e+t)},o=async.memoize(t,function(){return"custom hash"});o(1,2,function(n,t){e.equal(t,3),o(2,2,function(n,t){e.equal(t,3),e.done()})})},exports["memoize manually added memo value"]=function(e){e.expect(1);var n=async.memoize(function(){e(!1,"Function should never be called")});n.memo.foo=["bar"],n("foo",function(n){e.equal(n,"bar"),e.done()})},exports["falsy return values in series"]=function(e){function n(e){async.nextTick(function(){e(null,!1)})}function t(e){async.nextTick(function(){e(null,void 0)})}function o(e){async.nextTick(function(){e(null)})}function u(e){async.nextTick(function(){e(null,null)})}async.series([n,t,o,u],function(n,t){e.equal(t.length,4),e.strictEqual(t[0],!1),e.strictEqual(t[1],void 0),e.strictEqual(t[2],void 0),e.strictEqual(t[3],null),e.done()})},exports["falsy return values in parallel"]=function(e){function n(e){async.nextTick(function(){e(null,!1)})}function t(e){async.nextTick(function(){e(null,void 0)})}function o(e){async.nextTick(function(){e(null)})}function u(e){async.nextTick(function(){e(null,null)})}async.parallel([n,t,o,u],function(n,t){e.equal(t.length,4),e.strictEqual(t[0],!1),e.strictEqual(t[1],void 0),e.strictEqual(t[2],void 0),e.strictEqual(t[3],null),e.done()})},exports["queue events"]=function(e){var n=[],t=async.queue(function(e,t){n.push("process "+e),async.setImmediate(t)},10);t.concurrency=3,t.saturated=function(){e.ok(3==t.length(),"queue should be saturated now"),n.push("saturated")},t.empty=function(){e.ok(0==t.length(),"queue should be empty now"),n.push("empty")},t.drain=function(){e.ok(0==t.length()&&0==t.running(),"queue should be empty now and no more workers should be running"),n.push("drain"),e.same(n,["saturated","process foo","process bar","process zoo","foo cb","process poo","bar cb","empty","process moo","zoo cb","poo cb","moo cb","drain"]),e.done()},t.push("foo",function(){n.push("foo cb")}),t.push("bar",function(){n.push("bar cb")}),t.push("zoo",function(){n.push("zoo cb")}),t.push("poo",function(){n.push("poo cb")}),t.push("moo",function(){n.push("moo cb")})},exports["queue empty"]=function(e){var n=[],t=async.queue(function(e,t){n.push("process "+e),async.setImmediate(t)},3);t.drain=function(){e.ok(0==t.length()&&0==t.running(),"queue should be empty now and no more workers should be running"),n.push("drain"),e.same(n,["drain"]),e.done()},t.push([])},exports["queue started"]=function(e){var n=async.queue(function(){});e.equal(n.started,!1),n.push([]),e.equal(n.started,!0),e.done()};