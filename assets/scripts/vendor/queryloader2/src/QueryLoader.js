function QueryLoader2(e,t){this.element=e,this.$element=$(e),this.options=t,this.foundUrls=[],this.destroyed=!1,this.imageCounter=0,this.imageDone=0,this.alreadyLoaded=!1,this.preloadContainer=new PreloadContainer(this),this.overlayLoader=new OverlayLoader(this),this.defaultOptions={onComplete:function(){},onLoadComplete:function(){},backgroundColor:"#000",barColor:"#fff",overlayId:"qLoverlay",barHeight:1,percentage:!1,deepSearch:!0,completeAnimation:"fade",minimumTime:500},this.init()}QueryLoader2.prototype.init=function(){console.log("Initialising QueryLoader2 for",this.element),console.log("Setting the options"),this.options=$.extend({},this.defaultOptions,this.options),console.log("Looking for images in",this.element);this.findImageInElement(this.element);if(1==this.options.deepSearch){console.log("Deep searching for images in",this.element);for(var e=this.$element.find("*:not(script)"),t=0;t<e.length;t++)this.findImageInElement(e[t])}this.preloadContainer.create(),this.overlayLoader.createOverlay()},QueryLoader2.prototype.findImageInElement=function(e){var t="",o=$(e),n="normal";if("none"!=o.css("background-image")?(t=o.css("background-image"),n="background"):"undefined"!=typeof o.attr("src")&&"img"==e.nodeName.toLowerCase()&&(t=o.attr("src")),!this.hasGradient(t)){t=this.stripUrl(t);for(var r=t.split(", "),i=0;i<r.length;i++)if(this.validUrl(r[i])&&this.urlIsNew(r[i])){console.log("Found "+r[i]);var a="";if(this.isIE()||this.isOpera())a="?rand="+Math.random(),this.preloadContainer.addImage(r[i]+a);else if("background"==n)this.preloadContainer.addImage(r[i]+a);else{var s=new PreloadImage(this);s.element=o,s.bindLoadEvent()}this.foundUrls.push(r[i])}}},QueryLoader2.prototype.hasGradient=function(e){return-1==e.indexOf("gradient")?!1:!0},QueryLoader2.prototype.stripUrl=function(e){return e=e.replace(/url\(\"/g,""),e=e.replace(/url\(/g,""),e=e.replace(/\"\)/g,""),e=e.replace(/\)/g,"")},QueryLoader2.prototype.isIE=function(){return navigator.userAgent.match(/msie/i)},QueryLoader2.prototype.isOpera=function(){return navigator.userAgent.match(/Opera/i)},QueryLoader2.prototype.validUrl=function(e){return e.length>0&&!e.match(/^(data:)/i)?!0:!1},QueryLoader2.prototype.urlIsNew=function(e){return-1==this.foundUrls.indexOf(e)?!0:!1},QueryLoader2.prototype.destroyContainers=function(){this.destroyed=!0,this.preloadContainer.container.remove(),this.overlayLoader.container.remove()},QueryLoader2.prototype.endLoader=function(){console.log("Done preloading"),this.destroyed=!0,this.onLoadComplete()},QueryLoader2.prototype.onLoadComplete=function(){if(this.options.onLoadComplete(),"grow"==this.options.completeAnimation){var e=this.options.minimumTime;this.overlayLoader.loadbar[0].parent=this,this.overlayLoader.loadbar.stop().animate({width:"100%"},e,function(){$(this).animate({top:"0%",width:"100%",height:"100%"},500,function(){this.parent.overlayLoader.container[0].parent=this.parent,this.parent.overlayLoader.container.fadeOut(500,function(){this.parent.destroyContainers(),this.parent.options.onComplete()})})})}else{var e=this.options.minimumTime;this.overlayLoader.container[0].parent=this,this.overlayLoader.container.fadeOut(e,function(){this.parent.destroyContainers(),this.parent.options.onComplete()})}};